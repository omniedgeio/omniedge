# Maintainer: OmniEdge <support@omniedge.io>
pkgname=omniedge
pkgver=1.0.1
pkgrel=1
pkgdesc="OmniEdge Client - Peer-to-peer VPN solution"
arch=('x86_64')
url="https://connect.omniedge.io"
license=('GPL3')
depends=('gtk3' 'webkit2gtk-4.1')
optdepends=('networkmanager: for network management integration')
provides=('omniedge')
conflicts=('omniedge-git')
source=("omniedge"
        "omniedge-helper"
        "omniedge.desktop"
        "omniedge.png"
        "omniedge-helper.service")
sha256sums=('SKIP' 'SKIP' 'SKIP' 'SKIP' 'SKIP')

package() {
    # Install main binary
    install -Dm755 "$srcdir/omniedge" "$pkgdir/usr/bin/omniedge"
    
    # Install helper binary
    install -Dm755 "$srcdir/omniedge-helper" "$pkgdir/usr/bin/omniedge-helper"
    
    # Install desktop file
    install -Dm644 "$srcdir/omniedge.desktop" "$pkgdir/usr/share/applications/omniedge.desktop"
    
    # Install icon
    install -Dm644 "$srcdir/omniedge.png" "$pkgdir/usr/share/icons/hicolor/128x128/apps/omniedge.png"
    
    # Install systemd service
    install -Dm644 "$srcdir/omniedge-helper.service" "$pkgdir/usr/lib/systemd/system/omniedge-helper.service"
}

post_install() {
    echo ">>> To start the helper service, run:"
    echo "    sudo systemctl enable --now omniedge-helper"
    
    # Update icon cache
    gtk-update-icon-cache -q -t -f /usr/share/icons/hicolor
    
    # Update desktop database
    update-desktop-database -q
}

post_remove() {
    # Stop and disable helper service
    systemctl stop omniedge-helper 2>/dev/null || true
    systemctl disable omniedge-helper 2>/dev/null || true
    
    # Update icon cache
    gtk-update-icon-cache -q -t -f /usr/share/icons/hicolor
    
    # Update desktop database
    update-desktop-database -q
}
